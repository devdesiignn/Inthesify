import{initializeApp}from"https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";import{getAuth,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";import{getFirestore,collection,getDocs}from"https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyCoTVeUde0QJeBxMrj5J-6E0Cdwmn2AgjA",authDomain:"inthesify-new.firebaseapp.com",databaseURL:"https://inthesify-new-default-rtdb.firebaseio.com",projectId:"inthesify-new",storageBucket:"inthesify-new.appspot.com",messagingSenderId:"346177356137",appId:"1:346177356137:web:5823438d09c201978ebdf8"},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);function checkAuth(){onAuthStateChanged(auth,e=>{e||signout()})}const searchForms=document.querySelectorAll(".search-form"),searchInputs=document.querySelectorAll(".search-input"),searchPage=document.querySelector("#search-layout"),resultsPage=document.querySelector("#results-layout"),resultsContainer=document.querySelector("#results-container"),resultNotFound=' \n<div class="row justify-content-center mt-5">\n  <div class="col-md-6 text-center">\n    <img\n      src="img/not-found.svg"\n      alt="Result Not Found Illustration"\n      style="width: 240px"\n    />\n    <p class="mt-3">No results found. Try refining your search.</p>\n  </div>\n</div>';function showSearchPage(){searchPage.style.display="block",resultsPage.style.display="none"}function showResultsPage(){searchPage.style.display="none",resultsPage.style.display="block"}function displayResults(e,t){resultsContainer.innerHTML="",e&&0!==e.length?e.forEach(e=>{const t=document.createElement("div"),s=getAbstractPreview(e.abstract);t.innerHTML=`\n      <div class="row d-flex justify-content-center mb-2">\n        <div class="col-md-9">\n          <div class="card">\n            <div class="card-body">\n              <h5 class="card-title my-3">\n                <strong>${e.title.toUpperCase()}</strong>\n              </h5>\n              <div style="font-size: 16px">\n                <p class="card-text my-1">\n                  <strong>Author: </strong>${e.authorName.toUpperCase()}\n                </p>\n                <p class="card-text my-1">\n                  <strong>Date of Publication: </strong>${e.publicationDate}\n                </p>\n                <p class="card-text my-1">\n                  <strong>Abstract: </strong>${s}\n                </p>\n                <div class="d-flex justify-content-between my-1">\n                  <a href="${e.thesisURL}" class="card-link">Download</a>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,resultsContainer.appendChild(t)}):resultsContainer.innerHTML=resultNotFound}function getAbstractPreview(e){const t=e.split(" ");return t.length<=32?e:`${t.slice(0,32).join(" ")}...`}async function performSearch(e){const t=collection(db,"ThesesList"),s=await getDocs(t),n=[];s.forEach(t=>{const s=t.data();(s.title.toLowerCase().includes(e.toLowerCase())||s.abstract.toLowerCase().includes(e.toLowerCase()))&&n.push(s)}),showResultsPage(),displayResults(n,e)}searchForms.forEach(e=>{e.addEventListener("submit",async t=>{t.preventDefault();const s=searchInputs[0].value.trim()||searchInputs[1].value.trim();s&&(await performSearch(s),sessionStorage.setItem("Search?","true"),e.reset())}),e.reset()}),window.addEventListener("DOMContentLoaded",()=>{checkAuth();const e=sessionStorage.getItem("Search?");JSON.parse(e)?showResultsPage():showSearchPage()}),window.addEventListener("beforeunload",()=>{sessionStorage.removeItem("Search?")});